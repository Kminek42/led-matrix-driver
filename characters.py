dot_matrix_font = {
    'A': [
        " ### ",
        "#   #",
        "#   #",
        "#####",
        "#   #",
        "#   #",
        "#   #"
    ],
    'B': [
        "#### ",
        "#   #",
        "#   #",
        "#### ",
        "#   #",
        "#   #",
        "#### "
    ],
    'C': [
        " ### ",
        "#   #",
        "#    ",
        "#    ",
        "#    ",
        "#   #",
        " ### "
    ],
    'D': [
        "#### ",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        "#### "
    ],
    'E': [
        "#####",
        "#    ",
        "#    ",
        "#### ",
        "#    ",
        "#    ",
        "#####"
    ],
    'F': [
        "#####",
        "#    ",
        "#    ",
        "#### ",
        "#    ",
        "#    ",
        "#    "
    ],
    'G': [
        " ####",
        "#    ",
        "#    ",
        "# ###",
        "#   #",
        "#   #",
        " ####"
    ],
    'H': [
        "#   #",
        "#   #",
        "#   #",
        "#####",
        "#   #",
        "#   #",
        "#   #"
    ],
    'I': [
        " ### ",
        "  #  ",
        "  #  ",
        "  #  ",
        "  #  ",
        "  #  ",
        " ### "
    ],
    'J': [
        "  ###",
        "   # ",
        "   # ",
        "   # ",
        "   # ",
        "#  # ",
        " ##  "
    ],
    'K': [
        "#   #",
        "#  # ",
        "# #  ",
        "##   ",
        "# #  ",
        "#  # ",
        "#   #"
    ],
    'L': [
        "#    ",
        "#    ",
        "#    ",
        "#    ",
        "#    ",
        "#    ",
        "#####"
    ],
    'M': [
        "#   #",
        "## ##",
        "# # #",
        "# # #",
        "#   #",
        "#   #",
        "#   #"
    ],
    'N': [
        "#   #",
        "#   #",
        "##  #",
        "# # #",
        "#  ##",
        "#   #",
        "#   #"
    ],
    'O': [
        " ### ",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        " ### "
    ],
    'P': [
        "#### ",
        "#   #",
        "#   #",
        "#### ",
        "#    ",
        "#    ",
        "#    "
    ],
    'Q': [
        " ### ",
        "#   #",
        "#   #",
        "#   #",
        "# # #",
        "#  # ",
        " ## #",
    ],
    'R': [
        "#### ",
        "#   #",
        "#   #",
        "#### ",
        "# #  ",
        "#  # ",
        "#   #"
    ],
    'S': [
        " ### ",
        "#   #",
        "#    ",
        " ### ",
        "    #",
        "#   #",
        " ### "
    ],
    'T': [
        "#####",
        "  #  ",
        "  #  ",
        "  #  ",
        "  #  ",
        "  #  ",
        "  #  "
    ],
    'U': [
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        " ### "
    ],
    'V': [
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        " # # ",
        "  #  "
    ],
    'W': [
        "#   #",
        "#   #",
        "#   #",
        "# # #",
        "# # #",
        "# # #",
        " # # "
    ],
    'X': [
        "#   #",
        "#   #",
        " # # ",
        "  #  ",
        " # # ",
        "#   #",
        "#   #"
    ],
    'Y': [
        "#   #",
        "#   #",
        "#   #",
        " # # ",
        "  #  ",
        "  #  ",
        "  #  "
    ],
    'Z': [
        "#####",
        "    #",
        "   # ",
        "  #  ",
        " #   ",
        "#    ",
        "#####"
    ],
    'a': [
        "     ",
        "     ",
        " ### ",
        "    #",
        " ####",
        "#   #",
        " ### "
    ],
    'b': [
        "#    ",
        "#    ",
        "# ## ",
        "##  #",
        "#   #",
        "#   #",
        "#### "
    ],
    'c': [
        "     ",
        "     ",
        " ####",
        "#    ",
        "#    ",
        "#    ",
        " ####"
    ],
    'd': [
        "    #",
        "    #",
        " ## #",
        "#  ##",
        "#   #",
        "#   #",
        " ####"
    ],
    'e': [
        "     ",
        "     ",
        " ### ",
        "#   #",
        "#####",
        "#    ",
        " ### "
    ],
    'f': [
        "   ##",
        "  #  ",
        "  #  ",
        " ### ",
        "  #  ",
        "  #  ",
        "  #  "
    ],
    'g': [
        "     ",
        "     ",
        " ### ",
        "#   #",
        " ####",
        "    #",
        " ### "
    ],
    'h': [
        "#    ",
        "#    ",
        "# ## ",
        "##  #",
        "#   #",
        "#   #",
        "#   #"
    ],
    'i': [
        "  #  ",
        "     ",
        " ##  ",
        "  #  ",
        "  #  ",
        "  #  ",
        " ### "
    ],
    'j': [
        "   # ",
        "     ",
        "  ## ",
        "   # ",
        "   # ",
        "   # ",
        " ##  "
    ],
    'k': [
        " #   ",
        " #   ",
        " #  #",
        " # # ",
        " ##  ",
        " # # ",
        " #  #"
    ],
    'l': [
        " ##  ",
        "  #  ",
        "  #  ",
        "  #  ",
        "  #  ",
        "  #  ",
        " ### "
    ],
    'm': [
        "     ",
        "     ",
        "## # ",
        "# # #",
        "# # #",
        "# # #",
        "# # #"
    ],
    'n': [
        "     ",
        "     ",
        "# ## ",
        "##  #",
        "#   #",
        "#   #",
        "#   #"
    ],
    'o': [
        "     ",
        "     ",
        " ### ",
        "#   #",
        "#   #",
        "#   #",
        " ### "
    ],
    'p': [
        "     ",
        "     ",
        "#### ",
        "#   #",
        "#### ",
        "#    ",
        "#    "
    ],
    'q': [
        "     ",
        "     ",
        " ####",
        "#   #",
        " ####",
        "    #",
        "    #"
    ],
    'r': [
        "     ",
        "     ",
        "# ## ",
        "##  #",
        "#    ",
        "#    ",
        "#    "
    ],
    's': [
        "     ",
        "     ",
        " ####",
        "#    ",
        " ### ",
        "    #",
        "#### "
    ],
    't': [
        " #   ",
        "###  ",
        " #   ",
        " #   ",
        " #   ",
        " #  #",
        "  ## "
    ],
    'u': [
        "     ",
        "     ",
        "#   #",
        "#   #",
        "#   #",
        "#  ##",
        " ## #"
    ],
    'v': [
        "     ",
        "     ",
        "#   #",
        "#   #",
        " # # ",
        " # # ",
        "  #  "
    ],
    'w': [
        "     ",
        "     ",
        "#   #",
        "#   #",
        "# # #",
        "# # #",
        " # # "
    ],
    'x': [
        "     ",
        "     ",
        "##  #",
        "  ## ",
        "  #  ",
        " ##  ",
        "#  ##"
    ],
    'y': [
        "     ",
        "     ",
        "#   #",
        " #  #",
        "  ## ",
        "  #  ",
        "##   "
    ],
    'z': [
        "     ",
        "     ",
        "#####",
        "   # ",
        "  #  ",
        " #   ",
        "#####"
    ],
    '0': [
        " ### ",
        "#   #",
        "#  ##",
        "# # #",
        "##  #",
        "#   #",
        " ### "
    ],
    '1': [
        "   # ",
        "  ## ",
        " # # ",
        "   # ",
        "   # ",
        "   # ",
        "   # "
    ],
    '2': [
        " ### ",
        "#   #",
        "    #",
        "   # ",
        "  #  ",
        " #   ",
        "#####"
    ],
    '3': [
        " ### ",
        "#   #",
        "    #",
        "  ## ",
        "    #",
        "#   #",
        " ### "
    ],
    '4': [
        "   # ",
        "  ## ",
        " # # ",
        "#  # ",
        "#####",
        "   # ",
        "   # "
    ],
    '5': [
        "#####",
        "#    ",
        "#### ",
        "    #",
        "    #",
        "#   #",
        " ### "
    ],
    '6': [
        " ### ",
        "#   #",
        "#    ",
        "#### ",
        "#   #",
        "#   #",
        " ### "
    ],
    '7': [
        "#####",
        "#   #",
        "   # ",
        "  #  ",
        "  #  ",
        "  #  ",
        "  #  "
    ],
    '8': [
        " ### ",
        "#   #",
        "#   #",
        " ### ",
        "#   #",
        "#   #",
        " ### "
    ],
    '9': [
        " ### ",
        "#   #",
        "#   #",
        " ####",
        "    #",
        "#   #",
        " ### "
    ],
    '.': [
        "     ",
        "     ",
        "     ",
        "     ",
        "     ",
        "  #  ",
        "  #  "
    ],
    ',': [
        "     ",
        "     ",
        "     ",
        "     ",
        "  #  ",
        "  #  ",
        " #   "
    ],
    '!': [
        "  #  ",
        "  #  ",
        "  #  ",
        "  #  ",
        "  #  ",
        "     ",
        "  #  "
    ],
    '?': [
        " ### ",
        "#   #",
        "    #",
        "   # ",
        "  #  ",
        "     ",
        "  #  "
    ],
    '%': [
        "##  ",
        "##  #",
        "   # ",
        "  #  ",
        " #   ",
        "#  ##",
        "   ##",
    ],
    ' ': [ # Space character
        "     ",
        "     ",
        "     ",
        "     ",
        "     ",
        "     ",
        "     "
    ]
}

def character_to_bits(character):
    """
    Convert a character to its corresponding dot matrix representation in bits.
    
    Args:
        character (str): The character to convert.
        
    Returns:
        list: A list of strings representing the dot matrix for the character.
    """
    output = []
    for row in dot_matrix_font.get(character, dot_matrix_font[' ']):
        bits = ''.join('1' if pixel == '#' else ' ' for pixel in row)
        bits = bits.ljust(8)
        bits = bits.replace(' ', '0')
        bits = '0b' + bits
        output.append(bits)
    return output

def bits_to_c(bits: list, indentation: str = '    '):
    """
    Convert a list of bits to a C-style array representation.
    
    Args:
        bits (list): A list of strings representing the dot matrix in bits.
        
    Returns:
        str: A string representing the C-style array.
    """
    return f'{{\n{indentation}' + f',\n{indentation}'.join(bits) + '\n}'

def all_characters_to_c():
    """
    Convert all characters in the dot matrix font to C-style array representations.
    
    Returns:
        str: A string containing all characters formatted as C-style arrays.
    """
    output = []
    for char, bits in dot_matrix_font.items():
        char_to_display = char if char != ' ' else 'Space'
        output.append(f'// {char_to_display}')
        output.append(bits_to_c(character_to_bits(char)))
    return ',\n'.join(output)

def character_to_index(characters: dict, character: str) -> int:
    """
    Get the index of a character in the dot matrix font.
    
    Args:
        characters (dict): The dictionary containing characters and their representations.
        character (str): The character to find the index of.
        
    Returns:
        int: The index of the character, or -1 if not found.
    """
    return list(characters.keys()).index(character) if character in characters else -1

def mappings_to_c(characters: dict) -> str:
    """
    Generate a C-style function that maps characters to their dot matrix representations with switch logic.
    """
    output = []
    output.append('const uint8_t* get_character(char character) {')
    output.append('    switch (character) {')
    for char in characters.keys():
        if char == "'":
            case_char = "'\\''"
        elif char == '\\':
            case_char = "'\\\\'"
        elif char == '"':
            case_char = "'\\\"'"
        elif char == '\n':
            continue  # skip newlines
        elif char == ' ':
            case_char = "' '"
        else:
            case_char = f"'{char}'"
        index = character_to_index(characters, char)
        if index != -1:
            output.append(f'        case {case_char}: return font[{index}]; // {char}')
    output.append('        default: return font[0]; // Default to space character')
    output.append('    }')
    output.append('}')
    return '\n'.join(output)

output_path = 'characters.c'
with open(output_path, 'w') as f:
    f.write('#include "characters.h"\n\n')
    f.write('const uint8_t font[][7] = {\n')
    f.write(all_characters_to_c())
    f.write('\n};\n')
print(f'Character data written to {output_path}')

with open(output_path, 'a') as f:
    f.write('\n\n')
    f.write(mappings_to_c(dot_matrix_font))
print(f'Character mappings written to {output_path}')
